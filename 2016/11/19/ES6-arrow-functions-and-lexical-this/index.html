<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Wyatt Lindsey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ES6 arrow functions and lexical thisLet’s take a look at one of the quirkiest behaviors in JavaScript.  We’ll start by examining the legacy version of the language’s interpretation of the keyword this">
<meta property="og:type" content="article">
<meta property="og:title" content="Wyatt Lindsey">
<meta property="og:url" content="http://yoursite.com/2016/11/19/ES6-arrow-functions-and-lexical-this/index.html">
<meta property="og:site_name" content="Wyatt Lindsey">
<meta property="og:description" content="ES6 arrow functions and lexical thisLet’s take a look at one of the quirkiest behaviors in JavaScript.  We’ll start by examining the legacy version of the language’s interpretation of the keyword this">
<meta property="og:updated_time" content="2016-11-19T08:39:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wyatt Lindsey">
<meta name="twitter:description" content="ES6 arrow functions and lexical thisLet’s take a look at one of the quirkiest behaviors in JavaScript.  We’ll start by examining the legacy version of the language’s interpretation of the keyword this">
  
    <link rel="alternate" href="/atom.xml" title="Wyatt Lindsey" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Wyatt Lindsey</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ES6-arrow-functions-and-lexical-this" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/19/ES6-arrow-functions-and-lexical-this/" class="article-date">
  <time datetime="2016-11-19T08:38:02.000Z" itemprop="datePublished">2016-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ES6-arrow-functions-and-lexical-this"><a href="#ES6-arrow-functions-and-lexical-this" class="headerlink" title="ES6 arrow functions and lexical this"></a><strong>ES6 arrow functions and lexical <code>this</code></strong></h1><p>Let’s take a look at one of the quirkiest behaviors in JavaScript.  We’ll start by examining the legacy version of the language’s interpretation of the keyword <code>this</code>.  Then we’ll consider some new behavior introduced by ES6’s arrow functions.  How are they different?  Which approach is more intuitive and/or useful?  Read on for insight!</p>
<p>Prior to ECMAScript 2015 (a.k.a. ES6), JavaScript used an uncommon approach to the evaluation of <code>this</code>.  It made object-orientation in a functional language difficult.  For object-oriented design, <code>this</code> serves a critical purpose in creating objects that display polymorphism.  The ECMAScript 5.1 specification interprets so-called <em>ThisBinding</em> in a manner often described as confusing and unintuitive.</p>
<p><em>ThisBinding</em> is one of several execution contexts employed by the JavaScript interpreter to bind values to symbols.  When passing functions as callbacks to other functions, the value of <code>this</code> at runtime might surprise you.  For example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cupcake</span>(<span class="params">type, frosting</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.type = type;</div><div class="line">  <span class="keyword">this</span>.frosting = frosting;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.announce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'And now, the moment you\'ve been waiting for! Presenting...'</span>);</div><div class="line"></div><div class="line">    setTimeout(<span class="keyword">this</span>._present, <span class="number">1500</span>);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>._present = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'...a '</span> + <span class="keyword">this</span>.type +</div><div class="line">      <span class="string">' cupcake with '</span> + <span class="keyword">this</span>.frosting + <span class="string">' frosting'</span>);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> chocolateCupcake = <span class="keyword">new</span> Cupcake(<span class="string">'chocolate'</span>, <span class="string">'buttercream'</span>);</div><div class="line">chocolateCupcake.announce();</div></pre></td></tr></table></figure>
<p>Everything looks like it should work.  The <code>announce()</code> method is going to queue up some code for 1.5 seconds in the future.  The function it passes to <code>setTimeout</code> refers to some information about the cupcake.  These attributes are stored in that instance of the Cupcake object.  The helper function <code>_present()</code> is defined in the same scope as the member variables <code>this.type</code> and <code>this.frosting</code>.  So why do we get the following output?</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">And now, the moment you've been waiting for! Presenting...</div><div class="line">...a undefined cupcake with undefined frosting</div></pre></td></tr></table></figure>
<p>The problem is that when <code>present()</code> eventually goes off, the value of <code>this</code> is not this cupcake instance, even though <em>it really looks like it should be.</em>  After all, we’re defining <code>_present()</code> in the same block of code where we set the variables <code>this.type</code> and <code>this.frosting</code>.  In truth the value of <code>this</code> is decided later on, in the current execution context in which it was invoked.  In the case of <code>_present()</code>, when it’s invoked 1.5 seconds later, we’re actually in the global scope.  In that case, <code>this</code> refers to the global object <code>window</code>.</p>
<h2 id="Options-for-ThisBinding"><a href="#Options-for-ThisBinding" class="headerlink" title="Options for ThisBinding"></a>Options for ThisBinding</h2><h3 id="closure"><a href="#closure" class="headerlink" title="closure"></a>closure</h3><p>So how can we make the keyword <code>this</code> resolve to the thing we actually want and not <code>window</code>?  To write event-driven, asynchronous code we need our callbacks to know about the context in which they were defined, about the objects involved in the event.  If <code>this</code> were just like any other variable, we wouldn’t have anything to worry about.  In fact, assigning the value of <code>this</code> to a variable and then using <em>that variable</em> inside the callback provides one possible solution.  The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" target="_blank" rel="external">closure feature</a> of the language, part of lexical scoping, makes this possible:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cupcake</span>(<span class="params">type, frosting</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.type = type;</div><div class="line">  <span class="keyword">this</span>.frosting = frosting;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.announce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'And now, the moment you\'ve been waiting for! Presenting...'</span>);</div><div class="line"></div><div class="line">    setTimeout(<span class="keyword">this</span>._present, <span class="number">1500</span>);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>._present = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'...a '</span> + self.type +</div><div class="line">      <span class="string">' cupcake with '</span> + self.frosting + <span class="string">' frosting'</span>);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> chocolateCupcake = <span class="keyword">new</span> Cupcake(<span class="string">'chocolate'</span>, <span class="string">'buttercream'</span>);</div><div class="line">chocolateCupcake.announce();</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">And now, the moment you've been waiting for! Presenting...</div><div class="line">...a chocolate cupcake with buttercream frosting</div></pre></td></tr></table></figure>
<h3 id="the-bind-method"><a href="#the-bind-method" class="headerlink" title="the bind method"></a>the <code>bind</code> method</h3><p><code>Function.prototype.bind</code> allows us to use a specialized version of the function that bakes in arguments and the <code>this</code> binding.  When it’s invoked, the arguments are passed into the function as per usual.  Also, the function is called as if it were invoked in the same context as the scope in which it was defined before being passed as a callback.  Here’s an example of <code>bind</code> in action:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">  this.announce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'And now, the moment you\'ve been waiting for! Presenting...'</span>);</div><div class="line"></div><div class="line">    setTimeout(<span class="keyword">this</span>._present.bind(<span class="keyword">this</span>), <span class="number">1500</span>);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>._present = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'...a '</span> + <span class="keyword">this</span>.type +</div><div class="line">      <span class="string">' cupcake with '</span> + <span class="keyword">this</span>.frosting + <span class="string">' frosting'</span>);</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">And now, the moment you've been waiting for! Presenting...</div><div class="line">...a chocolate cupcake with buttercream frosting</div></pre></td></tr></table></figure>
<h2 id="Enter-ES6-arrow-functions"><a href="#Enter-ES6-arrow-functions" class="headerlink" title="Enter ES6 arrow functions"></a>Enter ES6 arrow functions</h2><p>Since we use anonymous functions so frequently in JavaScript, the new fat arrow functions in the ECMAScript 2015 spec are most welcome.  They afford the following advantages:</p>
<ul>
<li>concise syntax</li>
<li>lexical binding of <code>this</code></li>
<li>several syntactic sugar features</li>
</ul>
<p>Let’s take a look at the first two in action:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">this.announce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'And now, the moment you\'ve been waiting for! Presenting...'</span>);</div><div class="line"></div><div class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'...a '</span> + <span class="keyword">this</span>.type +</div><div class="line">      <span class="string">' cupcake with '</span> + <span class="keyword">this</span>.frosting + <span class="string">' frosting'</span>);</div><div class="line">  &#125;, <span class="number">1500</span>);</div><div class="line">&#125;;</div><div class="line">...</div></pre></td></tr></table></figure>
<p><code>And now, the moment you&#39;ve been waiting for! Presenting...
...a chocolate cupcake with buttercream frosting</code></p>
<p>Here’s another quick refactor using an arrow function and showing off its implicit return in a concise function body (no curly braces):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.on(<span class="string">'eat'</span>, (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.type + <span class="string">' cupcakes are delicious'</span>;</div><div class="line">&#125;).bind(<span class="keyword">this</span>));</div><div class="line"></div><div class="line"><span class="comment">// this ^^ becomes this:</span></div><div class="line"></div><div class="line"><span class="keyword">this</span>.on(<span class="string">'eat'</span>, () =&gt; (<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span> cupcakes are delicious`</span>));</div></pre></td></tr></table></figure>
<p>Arrow functions make it easy to inline anonymous functions in all those places we need them, such as asynchronous callbacks, higher order functions and event handlers.  <code>this</code> works just like most people would expect.  And the best part is, we can still <code>.bind</code>,  <code>.call</code> , <code>apply</code> and otherwise use the old ES5 non-arrow functions to our heart’s content in ES6.  The specification lets you mix and match both styles, so use whichever suits the situation.</p>
<h3 id="caveats"><a href="#caveats" class="headerlink" title="caveats"></a>caveats</h3><p>Some libraries like jQuery and Backbone have their own strategies for  <code>this</code>, which use ES5’s interpretation.  For example, many jQuery callbacks use <code>$(this)</code> to pinpoint the target object out of the DOM.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#cupcake'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  $(<span class="keyword">this</span>).append(<span class="string">'&lt;h1&gt;more HTML&lt;/h1&gt;'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>An arrow function would cause the selector above to fail, since the context isn’t what jQuery expects.  Backbone, on the other hand, passes around <code>this</code> as an additional parameter throughout its event system.  Arrow functions should work fine with the framework and probably make Backbone code more concise:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">this</span>.collection.on(<span class="string">'add'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.render();</div><div class="line">&#125;, <span class="keyword">this</span>);</div><div class="line"></div><div class="line"><span class="comment">// from this ^^ to this:</span></div><div class="line"></div><div class="line">myCollection.on(<span class="string">'add'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">this</span>.render();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Note that arrow functions can be invoked through <code>.call</code> and <code>.apply</code> but we can not pass in <code>this</code> as an argument, only regular variables.  Also, arrow functions do not have their own <code>arguments</code> object.  Rest parameters still work though.  For other quirks and features of arrow functions, see the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="external">MDN reference</a>.</p>
<h2 id="conclusion"><a href="#conclusion" class="headerlink" title="conclusion"></a>conclusion</h2><p>I don’t think I’ve ever heard someone say something nice about legacy JavaScript’s specification for <code>this</code> binding.  I personally find the behavior counterintuitive but workable.  ES5’s notion of the keyword has its own logic and we must know it backward and forward.  But going forward, the ES6 arrow function gives us another tool, one that delivers a little logical and syntactic sugar for our event-driven, async code.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/19/ES6-arrow-functions-and-lexical-this/" data-id="civoysix60000wipn3sfih64x" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/19/ES6-arrow-functions-and-lexical-this/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Wyatt Lindsey<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>